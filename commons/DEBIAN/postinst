#!/bin/bash
set -e

# Add user & group
addgroup --system jasmin
adduser --disabled-login \
		--disabled-password \
		--system \
		--home /usr/lib/jasmin \
		--ingroup jasmin \
		--no-create-home \
		--gecos "Jasmin SMS Gateway" \
		jasmin

# Create required folders
[ -d "/var/log/jasmin" ] || mkdir /var/log/jasmin

# Change owner of required folders
chown jasmin. /etc/jasmin/store/
chown jasmin. /var/log/jasmin

# Install init script
if [ -x "/lib/systemd/system/jasmind.service" ]; then
	systemctl enable jasmind
	systemctl start jasmind || exit $?
fi

# Install init script
if [ -x "/lib/systemd/system/jasmin-interceptord.service" ]; then
	systemctl enable jasmin-interceptord
	systemctl start jasmin-interceptord || exit $?
fi

# Install init script
if [ -x "/lib/systemd/system/jasmin-dlrd.service" ]; then
	systemctl enable jasmin-dlrd
	systemctl start jasmin-dlrd || exit $?
fi

# Install init script
if [ -x "/lib/systemd/system/jasmin-dlrlookupd.service" ]; then
	systemctl enable jasmin-dlrlookupd
	systemctl start jasmin-dlrlookupd || exit $?
fi

exit 0
